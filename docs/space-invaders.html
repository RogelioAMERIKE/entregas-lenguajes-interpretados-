<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Space Invaders</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; margin: auto; background: black; }
    #info {
      position: absolute;
      top: 10px;
      width: 100%;
      text-align: center;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 18px;
    }
    #vidas { position: absolute; left: 20px; top: 10px; }
    #nivel { position: absolute; right: 20px; top: 10px; }
  </style>
</head>
<body>
  <div id="info">
    <span id="vidas">Vidas: 3</span>
    <span id="puntos">Puntos: 0</span>
    <span id="nivel">Nivel: 1</span>
  </div>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // Jugador
    const jugador = { x: 370, y: 550, w: 60, h: 20, color: "lime" };

    // Variables de juego
    let balasJugador = [];
    let balasEnemigas = [];
    let enemigos = [];
    let defensas = [];
    let puntos = 0;
    let vidas = 3;
    let nivel = 1;
    let juegoActivo = true;
    let ultimoDisparo = 0;

    // Crear enemigos
    function crearEnemigos() {
      enemigos = [];
      for (let fila = 0; fila < 4; fila++) {
        for (let col = 0; col < 10; col++) {
          enemigos.push({
            x: 80 + col * 60,
            y: 50 + fila * 40,
            w: 40, h: 20,
            color: "red"
          });
        }
      }
    }

    // Crear defensas destructibles
    function crearDefensas() {
      defensas = [];
      let baseY = 450;
      for (let i = 0; i < 4; i++) {
        let baseX = 100 + i * 180;
        for (let fila = 0; fila < 3; fila++) {
          for (let col = 0; col < 6; col++) {
            defensas.push({
              x: baseX + col * 10,
              y: baseY + fila * 10,
              w: 10, h: 10,
              vida: 2,
              color: "cyan"
            });
          }
        }
      }
    }

    crearEnemigos();
    crearDefensas();

    // Disparo enemigo
    function disparoEnemigo() {
      if (enemigos.length > 0) {
        let e = enemigos[Math.floor(Math.random() * enemigos.length)];
        balasEnemigas.push({ x: e.x + e.w/2, y: e.y, w: 5, h: 10 });
      }
    }
    setInterval(disparoEnemigo, 1000);

    // Controles
    document.addEventListener("keydown", e => {
      if (!juegoActivo) return;

      if (e.key === "ArrowLeft" && jugador.x > 0) jugador.x -= 20;
      if (e.key === "ArrowRight" && jugador.x < canvas.width - jugador.w) jugador.x += 20;

      // Cooldown depende del nivel
      if (e.key === " ") {
        const ahora = Date.now();
        let cooldown = 1000; // nivel 1
        if (nivel === 2) cooldown = 700;
        if (nivel >= 3) cooldown = 500;

        if (ahora - ultimoDisparo >= cooldown) {
          balasJugador.push({ x: jugador.x + jugador.w/2 - 2, y: jugador.y, w: 5, h: 10 });
          ultimoDisparo = ahora;
        }
      }
    });

    // Colisiones
    function colision(a, b) {
      return a.x < b.x + b.w &&
             a.x + a.w > b.x &&
             a.y < b.y + b.h &&
             a.y + a.h > b.y;
    }

    // Actualizar
    function update() {
      if (!juegoActivo) return;

      // Mover balas jugador
      for (let b of balasJugador) b.y -= 5;
      balasJugador = balasJugador.filter(b => b.y > 0);

      // Mover balas enemigas
      for (let b of balasEnemigas) b.y += 5;
      balasEnemigas = balasEnemigas.filter(b => b.y < canvas.height);

      // Colisión balas jugador con enemigos
      for (let b of balasJugador) {
        for (let i = enemigos.length - 1; i >= 0; i--) {
          if (colision(b, enemigos[i])) {
            enemigos.splice(i, 1);
            balasJugador = balasJugador.filter(x => x !== b);
            puntos += 10;
            document.getElementById("puntos").textContent = "Puntos: " + puntos;
            break;
          }
        }
      }

      // Colisión balas con defensas
      for (let b of [...balasJugador, ...balasEnemigas]) {
        for (let d of defensas) {
          if (d.vida > 0 && colision(b, d)) {
            d.vida--;
            d.color = d.vida === 1 ? "blue" : "gray";
            if (balasJugador.includes(b)) {
              balasJugador = balasJugador.filter(x => x !== b);
            } else {
              balasEnemigas = balasEnemigas.filter(x => x !== b);
            }
            break;
          }
        }
      }

      // Colisión balas enemigas con jugador
      for (let b of balasEnemigas) {
        if (colision(b, jugador)) {
          vidas--;
          document.getElementById("vidas").textContent = "Vidas: " + vidas;
          balasEnemigas = balasEnemigas.filter(x => x !== b);
          if (vidas <= 0) {
            juegoActivo = false;
            alert("¡Game Over! Puntos: " + puntos);
          }
        }
      }

      // Si no quedan enemigos → siguiente nivel
      if (enemigos.length === 0) {
        nivel++;
        document.getElementById("nivel").textContent = "Nivel: " + nivel;
        crearEnemigos();
        crearDefensas();
      }
    }

    // Dibujar
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Jugador
      ctx.fillStyle = jugador.color;
      ctx.fillRect(jugador.x, jugador.y, jugador.w, jugador.h);

      // Enemigos
      for (let e of enemigos) {
        ctx.fillStyle = e.color;
        ctx.fillRect(e.x, e.y, e.w, e.h);
      }

      // Defensas
      for (let d of defensas) {
        if (d.vida > 0) {
          ctx.fillStyle = d.color;
          ctx.fillRect(d.x, d.y, d.w, d.h);
        }
      }

      // Balas
      ctx.fillStyle = "white";
      for (let b of balasJugador) ctx.fillRect(b.x, b.y, b.w, b.h);
      ctx.fillStyle = "yellow";
      for (let b of balasEnemigas) ctx.fillRect(b.x, b.y, b.w, b.h);
    }

    // Loop principal
    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    loop();
  </script>
</body>
</html>

